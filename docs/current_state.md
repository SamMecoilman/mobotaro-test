# CURRENT STATE（いまの作業位置）

- ブランチ：reboot
- フェーズ：
  - 土台構築（完了）
  - 入力統一（完了）
  - 最小戦闘ループ（PvE / PvP）（完了）
- 到達点：
  - TypeScript + Phaser（client）起動（Vite）
  - TypeScript + Colyseus（server）起動（Fastify + ws-transport）
  - client ↔ server 接続
  - サーバtick稼働（15/s）
  - 敵スポーン（仮：1.5s間隔）
  - MoveInput（x,y:-1..1）へ入力を統一
    - PC：WASD / 矢印
    - モバイル：左下仮想スティック
  - 攻撃入力の統一
    - PC：左クリック / 長押し（方向＝マウスカーソル）
    - モバイル：ワールド領域タップ / 長押し（方向＝タップ位置）
  - 手動攻撃の成立（射撃型・波動拳風）
  - サーバ権威ダメージ判定（PvE / PvP）
    - 敵へのダメージ → HP0で消滅
    - プレイヤーへのダメージ → HP0で死亡 → 一定後復帰
  - PvP成立
    - 他プレイヤーへの命中・HP減少・死亡→復帰
    - 自爆禁止
    - クールダウンは PvE / PvP 共通
    - Friendly Fire はサーバ定数で制御
  - PvP撃破XP
    - 撃破した相手が保持していた XP の 1/2 を取得
  - PvP接触ダメージ
    - プレイヤー同士の接触で双方に小ダメージ＋被弾演出
  - クリティカルヒット（運依存・サーバ判定）
  - ダメージ表示
    - 与ダメージ / 被ダメージで色分け
    - クリティカルは強調表示
    - 被弾時に赤パルス演出
  - 攻撃エフェクト同期
    - 他プレイヤーの攻撃エフェクトをサーバ起点で可視化
    - 自分の攻撃は二重表示しない
  - カメラ追従（主人公中心）＋背景スクロール
  - UIはカメラ非追従（画面固定）
  - 背景
    - map/school2.png を使用
    - 表示スケール：4倍
    - マップ端まで移動可能（サーバ側クランプ）
  - 主人公表示
    - Rect 表示を廃止
    - 連番 PNG スプライトアニメーションに差し替え
    - 番号順再生、サイズ 40x40
  - HP / SP 表示
    - ゲージ＋小さな数値（current / max）
    - PC / モバイル共通
    - SP 表示を sp / maxSp に統一
  - HUD 分岐
    - PC：左右・下の固定パネル
    - モバイル：最小HUD＋マップ上オーバーレイ＋FAB
  - モバイル画面対応
    - RESIZE で画面サイズに追従
    - 画面回転時に UI を再生成して崩れを抑制（完全解消は今後課題）
  - ネットワーク
    - WebSocket 接続
    - ホスト名自動判定（失敗時 localhost フォールバック）
    - サーバは 0.0.0.0 で待受

- ローカル起動：
  - npm install
  - npm run dev
  - http://localhost:5173
  - （任意）http://localhost:2567/health

- 既知の課題：
  - 背景画像サイズ変更時のクランプ範囲・カメラ境界・描画整合の最終確認
  - モバイル画面回転時のUI再生成は暫定対応（完全安定化は未）
  - 端末判定（スマホ / タブレット / PC）が UA 依存でブレる可能性

- 次の目標（直近）：
  - ステータス割り振り画面（キャラクター画面）のUX確定
    - PC：左パネル導線
    - モバイル：FAB内キャラクターボタン導線
  - PvP / PvE 時の視認性・演出バランス調整
  - UI（FAB含む）の整理と誤操作防止の最終調整

- 次の目標（中期）：
  - state 同期を描画に完全統一（player / enemy を state 駆動）
  - Survivor Battle Area の進行フロー整理
  - LvUP → 強化選択 → 効果適用の体験設計調整
