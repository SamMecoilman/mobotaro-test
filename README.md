**ゲームを確認するURL**
https://sammecoilman.github.io/mobotaro-test/

**仕様書**
https://docs.google.com/spreadsheets/d/1wQB0SawXlo99-0tyQV12KY2qY3B5arnye6DbYPe50U0/edit?gid=0#gid=0


## 🧾 開発依頼テンプレート（ChatGPT用）

### 【1. 今回の目的・仕様リマインド】 ###
- ゲームジャンル：PvPvEアクション（2Dタイル移動）
- Discord連携あり（メンバー名＝プレイヤー名）
- プレイヤー　vs 他プレイヤー vs モブ敵（不良、生徒会）、vs 足立先生（レイドボス）
- 攻撃は方向依存、HP・ATK・会心率あり
- 複数プレイヤーで同じ敵やボスを攻撃する可能性あり
- 仕様書：https://github.com/SamMecoilman/mobotaro-test/blob/main/dev.md

---

### 【2. 毎回AIにお願いしたいこと】
- 現在のリポジトリ https://github.com/SamMecoilman/mobotaro-test 既存ロジックに影響が出ないような機能拡張、改善方法を教えてほしい
- 修正したいファイル：main.js
- 修正したい関数名：不明
- 内容：
- 要件：具体的に既存ソースのどの部分にどういったソースを挿入・実装すればいいか教えてほしい

# 🎮 モブ太郎伝説 仕様書

## 🧾 概要
- **タイトル**: モブ太郎伝説
- **ジャンル**: 2DアクションRPG（PvPvE型MMORPG）
- **目的**: Discord連携型の学園MMORPGで、モブ学生として最強を目指す！
- **舞台**: 武闘派高校（4階建て＋屋上）

## 🕹️ 操作方法・環境
- **移動方式**: 32×32 タイルベース
- **対応環境**: PCブラウザ（スマホは今後対応予定）
- **操作キー（PC版）**:
    - **矢印キー**: 移動
    - **スペースキー**: 攻撃（向いている方向にのみ有効）
    - **ESCキー**: CONFIG表示
- **操作（スマホ版）**: 十字キーUIおよび攻撃ボタンをタップ
- **UI**: Discord上でのコマンド入力不要（UI完結型）

## 🧍‍♂️ プレイヤー情報・成長
- **名前**: Discordユーザー名と連動
- **ステータス**: HP、攻撃、防御、素早さ、会心率
- **成長要素**: レベルアップ時にステータスポイントを振り分け可能
- **常時表示UI**: HPバー、レベル、所持金（最大9999G）

## ⚔️ バトルシステム
### PvP（対プレイヤー）
- **攻撃**: 手動（クリック／タップ）
- **ボーナス**: 背後攻撃でダメージ2〜3倍
- **結果**: 勝利で経験値・所持金を獲得、敗北で経験値ロスト（低Lv保護あり）

### PvE（対モブ敵）
- **敵種**: 不良、生徒会など
- **特徴**: 当たり判定あり（すり抜け不可）、勝利で経験値＋少額所持金

### レイドボス：足立先生
- **出現条件**: Lv30以上のプレイヤーが複数存在
- **演出**: 「足立先生、降臨」のメッセージと専用BGM
- **報酬**: MVP報酬あり、10秒後にリスポーン通知

## 🎵 音楽・演出
### BGM構成
| シーン | ファイル名 | 備考 |
| :--- | :--- | :--- |
| メニュー画面 | `menu_bgm.mp3` | ピコピコ系ファミコン風 |
| ゲーム本編 | `game_bgm.mp3` | ドラクエ風 |
| 足立先生戦 | `adachi_bgm.mp3` | 緊迫感のあるボス戦風 |

- **音量調整**: CONFIGから0.00〜1.00（0.01刻み）で調整可能

### グラフィック・エフェクト
- **キャラサイズ**: 32×48px（アニメーション：前後左右 各3フレーム）
- **エフェクト**: 攻撃時の光の衝撃波、クリティカル時の1マスノックバック
- **被弾演出**: 白化 ＋ 💀浮上 ＋ フェード
- **ダメージ表示**: 敵の頭上に数値をポップアップ

## 🧪 アイテム（購買部）
| アイテム名 | 効果 | 価格 |
| :--- | :--- | :--- |
| 包帯 | HP50回復 | 100G |
| 弁当 | HP全回復 | 300G |
| 高級焼肉弁当 | HP全回復＋会心率UP（10秒） | 500G |

- **購入**: NPCショップでタップして即使用

## 🏫 マップ構造・ギミック
- **タイルサイズ**: 32×32px（キャラはタイル中央に自動整列）
- **特殊エリア**:
    - **音楽室**: 爆音によりHP減少
    - **花壇**: 立ち止まるとHP微回復
    - **昇降口**: 靴を盗まれ素早さ−5

## 📋 メニュー画面（タイトルUI）
- **項目**: 入学する（New Game）、再登校（Continue）、設定
- **演出**: 学校マップのスクロール、ロゴ浮遊、モブキャラの走行とセリフ（例：「僕が伝説になる世界線に…」）

## 💬 Discord連携
- **ログ投稿**: 討伐、レベルアップ、足立先生出現などを自動投稿
- **特典**: 特定ロール保持者に初期Lv10、経験値+10%などのボーナス

## 🛠️ 技術スタック
- **ゲームエンジン**: Godot 4 (HTML5)
- **Bot/サーバー**: Python (discord.py) / Replit
- **データベース**: JSON or SQLite
- **ホスティング**: GitHub Pages (UI) / Replit (Bot)

## 🗂️ 主要関数一覧
| 関数名 | 機能概要 |
| :--- | :--- |
| `snapToGrid(value)` | 値を32ピクセル単位に丸めてタイル座標に変換 |
| `updateUI()` | HPと攻撃力を画面に反映 |
| `updatePosition()` | キー入力に応じた座標・向きの更新 |
| `checkCollision(x, y)` | 指定座標の敵との衝突判定 |
| `showDamage(amt, tgt)` | ターゲット上にダメージを表示（1秒で消失） |
| `checkHit()` | 攻撃の命中判定とダメージ処理 |
| `animate()` | 歩行アニメーションのループ処理 |
| `startGame()` | UI・BGMの切り替えとゲーム開始 |
| `spawnAdachi()` | 足立先生の出現とBGM切り替え |
